/**
* snakepong
* version: 0.1.0
* date: 29-09-2013
*
* Â©2013 Slemgrim
* slemgrim@gmail.com 
*
* License: GNU GENERAL PUBLIC LICENSE v2
*/
define("app/log",[],function(){return{error:function(e){console.log("WARNING: "+e)},warn:function(e){console.log("ERROR: "+e)},info:function(e){console.log(e)}}}),define("app/event",[],function(){return{add:function(t,n,r){t.addEventListener?t.addEventListener(n,r,!1):t.attachEvent?t.attachEvent("on"+n,r):t["on"+n]=r},remove:function(){console.log("remove")},preventDefault:function(e){e.preventDefault()}}}),define("app/dom",[],function(){return{el:function(e,t){return t?t.querySelector(e):document.querySelector(e)},els:function(e,t){return t?t.querySelectorAll(e):document.querySelectorAll(e)}}}),define("app/classlist",[],function(){return{add:function(e,t){e.classList.add(t)},remove:function(e,t){e.classList.remove(t)},toggle:function(e,t){e.classList.toggle(t)},contains:function(e,t){return e.classList.contains(t)}}}),define("app/core",["app/log","app/event","app/dom","app/classlist"],function(e,t,n,r){return{log:e,event:t,dom:n,classlist:r}}),define("gui/debug",["app/core"],function(e){return function(t,n){var r=function(){i()},i=function(){e.event.add(t,"click",s)},s=function(t){e.event.preventDefault(t),e.classlist.toggle(n,"show")};r()}}),define("gui/canvas-handler",["app/core"],function(e){return function(t){var n,r,i=[],s=200,o=null;this.registerListener=function(e){i.push(e)},this.update=function(){f()};var u=function(){a(),f()},a=function(){e.event.add(window,"resize",f)},f=function(){o!=null&&clearTimeout(o),o=window.setTimeout(function(){l()},s)},l=function(){c(),h(),p()},c=function(){n=t.offsetWidth,r=t.offsetHeight},h=function(){t.setAttribute("width",n),t.setAttribute("height",r)},p=function(){for(var e=0;e<i.length;e++)i[e].canvasChange(n,r)};u()}}),define("game/loop",[],function(){return function(e){var t={deltaTime:.01,maxFrameTime:.25,fpsCallback:!1,renderCallback:!1,updateCallback:!1,clock:!1},n="",r=0,i=0,s=0,o=0,u={RUNNING:0,PAUSED:1,STOPPED:2},a=function(){if(typeof e=="object")for(var r in t)e[r]||(e[r]=t[r]);else e=t;e.clock||(e.clock=c),n=u.STOPPED};this.setUpdateCallback=function(t){e.updateCallback=t},this.setRenderCallback=function(t){e.rendererCallback=newRenderCallback},this.start=function(e){n==u.STOPPED&&(s=l(),n=u.RUNNING,e&&e(),f())},this.pause=function(e){n==u.RUNNING&&(n=u.PAUSED,e&&e())},this.stop=function(e){n!=u.STOPPED&&(n=u.STOPPED,e&&e())},this.resume=function(e){n==u.PAUSED&&(n=u.RUNNING,e&&e(),f())},this.setFPSCallback=function(t){t&&(e.fpsCallback=t)},this.setDeltaTime=function(t){e.deltaTime=t};var f=function(){if(n==u.RUNNING){var t=l(),a=t-s;i=1/a*1e3,e.fpsCallback&&e.fpsCallback(i),a>e.maxFrameTime&&(a=e.maxFrameTime),s=t,o+=a;while(o>=e.deltaTime)e.updateCallback&&e.updateCallback(e.deltaTime),r+=e.deltaTime,o-=e.deltaTime;e.renderCallback&&e.renderCallback(),e.clock(f)}},l=function(){return date=new Date,date.getTime()},c=function(e){window.requestAnimationFrame?window.requestAnimationFrame(e):window.webkitRequestAnimationFrame?window.webkitRequestAnimationFrame(e):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(e):window.setTimeout(e,1e3/60)};a()}}),define("game/debug",["app/core","game/loop"],function(e,t){return function(e){var n=[],r,i,s=e.width;this.addFps=function(e){n=n.splice(s*-1,s),n.push(e)};var o=function(){r=new t({renderCallback:u}),i=e.getContext("2d"),r.start()},u=function(){i.clearRect(0,0,e.width,e.height),i.fillStyle="#000000",i.fillRect(0,0,e.width,e.height),i.fillStyle="#00ff00";var t=1;n.map(function(e){i.fillRect(t,100-e,1,e),t++}),i.fillStyle="#ff0000",i.fillRect(0,40,e.width,1),i.fillStyle="#cccccc",i.fillRect(0,0,e.width,1),i.fillRect(0,25,e.width,1),i.fillRect(0,50,e.width,1),i.fillRect(0,75,e.width,1),i.fillRect(0,99,e.width,1)};o()}}),define("game/vector2",["app/core"],function(e){return function(e,t){this.x=e||0,this.y=t||0,this.reset=function(e,t){return this.x=e,this.y=t,this},this.copyTo=function(e){return e.x=this.x,e.y=this.y,this},this.copyFrom=function(e){return this.x=e.x,this.y=e.y,this},this.add=function(e){return this.x+=e.x,this.y+=e.y,this},this.addX=function(e){return this.x+=e,this},this.addY=function(e){return this.y+=e,this},this.sub=function(e){return this.x-=e.x,this.y-=e.y,this},this.subX=function(e){return this.x-=e,this},this.subY=function(e){return this.y-=e,this},this.mul=function(e){return this.x*=e.x,this.y*=e.y,this},this.mulScalar=function(e){return this.x*=e,this.y*=e,this},this.perp=function(){var e=this.x;return this.x=this.y,this.y=-e,this},this.reverse=function(){return this.x=-this.x,this.y=-this.y,this},this.nor=function(){var e=this.len();return e>0&&(this.x=this.x/e,this.y=this.y/e),this},this.scale=function(e,t){return this.x*=e,this.y*=t||e,this},this.project=function(e){var t=this.dot(e)/e.len2();return this.x=t*e.x,this.y=t*e.y,this},this.projectN=function(e){var t=this.dot(e);return this.x=t*e.x,this.y=t*e.y,this},this.reflect=function(e){var t=this.x,n=this.y;return this.project(e).scale(2),this.x-=t,this.y-=n,this},this.reflectN=function(e){var t=this.x,n=this.y;return this.projectN(e).scale(2),this.x-=t,this.y-=n,this},this.dot=function(e){return this.x*e.x+this.y*e.y},this.len2=function(){return this.dot(this)},this.len=function(){return Math.sqrt(this.len2())}}}),define("game/collision/polygon",["app/core","game/vector2"],function(e,t){return function(e,n,r){this.TYPE="POLYGON",this.position=new t(e,n),this.points=r||[],this.edges=[],this.normals=[];var i=function(){s()};this.set=function(e,t){this.position.x=e.x,this.position.y=e.y,t&&(this.points=t),s()};var s=function(){var e=this.points,n=e.length;this.edges=[],this.normals=[];for(var r=0;r<n;r++){var i=e[r],s=r<n-1?e[r+1]:e[0],o=(new t).copy(s).sub(i),u=(new t).copy(o).perp().normalize();this.edges.push(o),this.normals.push(u)}};i()}}),define("game/collision/rectangle",["app/core","game/vector2","game/collision/polygon"],function(e,t,n){return function(e,r,i,s){this.TYPE="RECT",this.size=new t(i,s),this.position=new t(e,r),this.update=function(e,t){this.position=e,t&&(this.size=t)},this.set=function(e){this.position.x=e.x,this.position.y=e.y},this.toPolygon=function(){return new n(new t(this.position.x,position.y),[new t(0,0),new t(this.size.x,0),new t(this.size.x,this.size.y),new t(0,this.size.y)])}}}),define("game/item/ball",["app/core","game/vector2","game/collision/rectangle"],function(e,t,n){return function(e,r,i){this.TYPE="BALL",this.radius=i,this.size=new t(i*2,i*2),this.position=new t(e,r),this.velocity=new t(0,0),this.speed=1,this.friction=.001,this.affectedByGravity=!1,this.bounds=new n(e,r,i*2,i*2),this.update=function(e){var n=new t(this.velocity.x,this.velocity.y);n.mulScalar(this.speed*e),this.position.add(n),this.bounds.set(this.position),this.velocity.mulScalar(1-this.friction)},this.addForce=function(e){this.velocity.add(e)}}}),define("game/item/player",["app/core","game/vector2","game/collision/rectangle"],function(e,t,n){return function(e,r,i,s){this.TYPE="PLAYER",this.size=new t(i,s),this.position=new t(e,r),this.velocity=new t(0,0),this.speed=1,this.friction=0,this.affectedByGravity=!1,this.bounds=new n(e,r,i,s),this.update=function(e){var n=new t(this.velocity.x,this.velocity.y);n.mulScalar(this.speed*e),this.position.add(n),this.bounds.set(this.position),this.velocity.mulScalar(1-this.friction)},this.addForce=function(e){this.velocity.add(e)}}}),define("game/item/wall",["app/core","game/vector2","game/collision/rectangle"],function(e,t,n){return function(e,r,i,s){this.TYPE="WALL",this.size=new t(i,s),this.position=new t(e,r),this.velocity=new t(0,0),this.speed=0,this.friction=0,this.affectedByGravity=!1,this.static=!0,this.bounds=new n(e,r,i,s),this.update=function(e){var n=new t(this.velocity.x,this.velocity.y);n.mulScalar(this.speed*e),this.position.add(n),this.bounds.set(this.position),this.velocity.mulScalar(1-this.friction)},this.addForce=function(e){this.velocity.add(e)}}}),define("game/collision/sat",["app/core","game/vector2"],function(e,t){return function(){var e=[],n=[],r=-1,i=0,s=1,o=function(){for(var r=0;r<10;r++)e.push(new t);for(var r=0;r<5;r++)n.push([])},u=function(e,t,n){var r=Number.MAX_VALUE,i=-Number.MAX_VALUE,s=e.length;for(var o=0;o<s;o++){var u=e[o].dot(t);u<r&&(r=u),u>i&&(i=u)}n[0]=r,n[1]=i},a=function(t,r,i,s,o,a){var f=n.pop(),l=n.pop(),c=e.pop().copy(r).sub(t),h=c.dot(o);u(i,o,f),u(s,o,l),l[0]+=h,l[1]+=h;if(f[0]>l[1]||l[0]>f[1])return e.push(c),n.push(f),n.push(l),!0;if(a){var p=0;if(f[0]<l[0]){a.aInB=!1;if(f[1]<l[1])p=f[1]-l[0],a.bInA=!1;else{var d=f[1]-l[0],v=l[1]-f[0];p=d<v?d:-v}}else{a.bInA=!1;if(f[1]>l[1])p=f[0]-l[1],a.aInB=!1;else{var d=f[1]-l[0],v=l[1]-f[0];p=d<v?d:-v}}var m=Math.abs(p);m<a.overlap&&(a.overlap=m,a.overlapN.copy(o),p<0&&a.overlapN.reverse())}return e.push(c),n.push(f),n.push(l),!1},f=function(e,t){var n=e.len2(),o=t.dot(e);return o<0?r:o>n?s:i},l=function(e,t,n){var r=e.points,i=r.length,s=t.points,o=s.length;for(var u=0;u<i;u++)if(a(e.position,t.position,r,s,e.normals[u],n))return!1;for(var u=0;u<o;u++)if(a(e.position,t.position,r,s,t.normals[u],n))return!1;return n&&(n.a=e,n.b=t,n.overlapV.copy(n.overlapN).scale(n.overlap)),!0};o()}}),define("game/collision/response",["app/core","game/vector2"],function(e,t){return function(){this.a=null,this.b=null,this.overlapN=new t,this.overlapN=new t,this.overlap=Number.MAX_VALUE,this.aInB=!0,this.bInA=!0,this.clear(),this.clear=function(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this}}}),define("game/collision/collision-handler",["app/core","game/vector2","game/collision/sat","game/collision/response"],function(e,t,n,r){return function(){var e,i,s,o,u=function(){s=new n,o=new r};this.check=function(t){e=t;for(var n=0;n<e.length;n++){i=e[n];if(i.static)continue;a()}};var a=function(){for(var t=0;t<e.length;t++){var n=e[t];if(i===n)continue;f(i,n)}},f=function(e,t){var n=e.bounds,r=t.bounds,i={left:n.position.x-n.size.x/2,right:n.position.x+n.size.x/2,top:n.position.y-n.size.y/2,bottom:n.position.y+n.size.y/2},s={left:r.position.x-r.size.x/2,right:r.position.x+r.size.x/2,top:r.position.y-r.size.y/2,bottom:r.position.y+r.size.y/2};s.left>i.right||s.right<i.left||s.top>i.bottom||s.bottom<i.top||c(e,t,i,s)},l=function(e,t,n){return Math.min(Math.max(e,t),n)},c=function(e,n,r,i){var s=l(e.position.x,i.left,i.right),o=l(e.position.y,i.bottom,i.top);if(s>o)var u=new t(s,0);else var u=new t(0,o);e.position.sub(u)};u()}}),define("game/world",["app/core","game/vector2","game/item/ball","game/item/player","game/item/wall","game/collision/collision-handler"],function(e,t,n,r,i,s){return function(){this.size=new t(300,200),this.gravity=new t(0,1),this.items=[new n(this.size.x/2,this.size.y/2,5),new r(10,this.size.y/2,3,30),new r(this.size.x-10,this.size.y/2,3,30),new i(this.size.x/2,2.5,this.size.x,5),new i(2.5,this.size.y/2,5,this.size.y),new i(this.size.x/2,this.size.y-2.5,this.size.x,5),new i(this.size.x-2.5,this.size.y/2,5,this.size.y)];var e,o=function(){e=new s};this.update=function(n){var r=new t(this.gravity.x,this.gravity.y);r.mulScalar(n);for(var i=0;i<this.items.length;i++)item=this.items[i],item.update(n),u(item,r);e.check(this.items)};var u=function(e,t){e.affectedByGravity&&e.addForce(t)};o()}}),define("game/render2D",["app/core"],function(e){return function(e){var t,n,r,i,s=0,o=0,u=!0,a=function(){t=e.getContext("2d"),f()};this.initCanvas=function(){i=!1},this.toggleBoundingBoxes=function(){u=!u},this.init=function(){a()},this.draw=function(e){n=e.world,r=e.camera,i||l(),f(),h();for(var t=0;t<n.items.length;t++)p(n.items[t])};var f=function(){t.clearRect(0,0,e.width,e.height),t.fillStyle="#000000",t.fillRect(0,0,e.width,e.height)},l=function(){if(r){var t=e.width/r.size.x,n=e.height/r.size.y;i=t<n?t:n,s=e.width/2-r.size.x*i/2,o=e.height/2-r.size.y*i/2}},c=function(e){return e*i},h=function(){var e=c(r.size.x,"x"),n=c(r.size.y,"y");t.fillStyle="#ffffff",t.fillRect(s,o,e,n)},p=function(n){if(!d(n))return;var r=c(n.position.x)+s,i=c(n.position.y)+o,a=c(n.size.x),f=c(n.size.y);u&&n.bounds&&m(n.bounds),t.translate(r,e.height-i),t.fillStyle=v(n.TYPE),t.fillRect(-a/2,-f/2,a,f),t.translate(r*-1,(e.height-i)*-1)},d=function(e){return e.position.x-e.size.x/2>r.size.x||e.position.x+e.size.x/2<0||e.position.y-e.size.y/2>r.size.x||e.position.y+e.size.y/2<0?!1:!0},v=function(e){var t;switch(e){case"BALL":t="#eeeeee";break;case"PLAYER":t="#0000ff";break;case"WALL":t="#00ff00";break;default:t="#000000"}return t},m=function(n){t.beginPath(),t.lineWidth=1,t.strokeStyle="#ff0000";var r=c(n.position.x)+s,i=c(n.position.y)+o;switch(n.TYPE){case"RECT":var u=c(n.size.x),a=c(n.size.y);t.rect(r-u/2,e.height-(i+a/2),u,a);break;case"CIRCLE":var f=c(n.radius/2);t.arc(r,e.height-i,f,0,Math.PI*2,!0)}t.stroke()};a()}}),define("game/camera",["app/core","game/vector2"],function(e,t){return function(e,n,r,i){this.size=new t(r,i),this.position=new t(e,n);var s=function(){};s()}}),define("game/snakepong",["app/core","game/loop","game/debug","game/world","game/render2D","game/camera"],function(e,t,n,r,i,s){return function(o){var u,a,f,l,c,h,p,d=e.dom.el("#debug"),v=e.dom.el(".fps",d),m=function(){c=new i(o),g(),u=new t({updateCallback:y,renderCallback:b,fpsCallback:w}),E(),u.start()},g=function(){a=new r,h=new s(150,100,300,200)},y=function(e){a.update(e)},b=function(){c.draw({camera:h,world:a})};this.canvasChange=function(e,t){c.initCanvas()};var w=function(e){v.innerHTML=e.toFixed(2),p.addFps(e)},E=function(){$start=e.dom.el("nav .start",d),$start.onclick=function(){u.start()},$pause=e.dom.el("nav .pause",d),$pause.onclick=function(){u.pause()},$resume=e.dom.el("nav .resume",d),$resume.onclick=function(){u.resume()},$stop=e.dom.el("nav .stop",d),$stop.onclick=function(){u.stop(),g()},$boundingToggle=e.dom.el("nav .boundingToggle",d),$boundingToggle.onclick=function(){c.toggleBoundingBoxes()},p=new n(e.dom.el("#debugFps",d))};m()}}),require.config({baseUrl:"src"}),require(["app/core","gui/debug","gui/canvas-handler","game/snakepong"],function(e,t,n,r){var i=e.dom.el(".game"),s=e.dom.el("#main-canvas"),o,u,a,f=function(){l(),o=new r(s),u=new t(e.dom.el(".debug"),e.dom.el("#debug")),a=new n(s),a.registerListener(o)},l=function(){var t=e.dom.el(".toggleFullscreen",i);e.event.add(t,"click",c)},c=function(){e.classlist.toggle(i,"fullscreen"),a.update()};f()}),define("main",function(){});