/**
* snakepong
* version: 0.1.0
* date: 29-09-2013
*
* Â©2013 Slemgrim
* slemgrim@gmail.com 
*
* License: GNU GENERAL PUBLIC LICENSE v2
*/
define("app/log",[],function(){return{error:function(e){console.log("WARNING: "+e)},warn:function(e){console.log("ERROR: "+e)},info:function(e){console.log(e)}}}),define("app/event",[],function(){return{add:function(t,n,r){t.addEventListener?t.addEventListener(n,r,!1):t.attachEvent?t.attachEvent("on"+n,r):t["on"+n]=r},remove:function(){console.log("remove")},preventDefault:function(e){e.preventDefault()}}}),define("app/dom",[],function(){return{el:function(e,t){return t?t.querySelector(e):document.querySelector(e)},els:function(e,t){return t?t.querySelectorAll(e):document.querySelectorAll(e)}}}),define("app/classlist",[],function(){return{add:function(e,t){e.classList.add(t)},remove:function(e,t){e.classList.remove(t)},toggle:function(e,t){e.classList.toggle(t)},contains:function(e,t){return e.classList.contains(t)}}}),define("app/core",["app/log","app/event","app/dom","app/classlist"],function(e,t,n,r){return{log:e,event:t,dom:n,classlist:r}}),define("gui/debug",["app/core"],function(e){return function(t,n){var r=function(){i()},i=function(){e.event.add(t,"click",s)},s=function(t){e.event.preventDefault(t),e.classlist.toggle(n,"show")};r()}}),define("gui/canvas-handler",["app/core"],function(e){return function(t){var n,r,i=[],s=200,o=null;this.registerListener=function(e){i.push(e)};var u=function(){a(),f()},a=function(){e.event.add(window,"resize",f)},f=function(){o!=null&&clearTimeout(o),o=window.setTimeout(function(){l()},s)},l=function(){c(),h(),p()},c=function(){n=t.offsetWidth,r=t.offsetHeight},h=function(){t.setAttribute("width",n),t.setAttribute("height",r)},p=function(){for(var e=0;e<i.length;e++)i[e].canvasChange(n,r)};u()}}),define("game/loop",[],function(){return function(e){var t={deltaTime:.01,maxFrameTime:.25,fpsCallback:!1,renderCallback:!1,updateCallback:!1,clock:!1},n="",r=0,i=0,s=0,o=0,u={RUNNING:0,PAUSED:1,STOPPED:2},a=function(){if(typeof e=="object")for(var r in t)e[r]||(e[r]=t[r]);else e=t;e.clock||(e.clock=c),n=u.STOPPED};this.setUpdateCallback=function(t){e.updateCallback=t},this.setRenderCallback=function(t){e.rendererCallback=newRenderCallback},this.start=function(e){n==u.STOPPED&&(s=l(),n=u.RUNNING,e&&e(),f())},this.pause=function(e){n==u.RUNNING&&(n=u.PAUSED,e&&e())},this.stop=function(e){n!=u.STOPPED&&(n=u.STOPPED,e&&e())},this.resume=function(e){n==u.PAUSED&&(n=u.RUNNING,e&&e(),f())},this.setFPSCallback=function(t){t&&(e.fpsCallback=t)},this.setDeltaTime=function(t){e.deltaTime=t};var f=function(){if(n==u.RUNNING){var t=l(),a=t-s;i=1/a*1e3,e.fpsCallback&&e.fpsCallback(i),a>e.maxFrameTime&&(a=e.maxFrameTime),s=t,o+=a;while(o>=e.deltaTime)e.updateCallback&&e.updateCallback(e.deltaTime),r+=e.deltaTime,o-=e.deltaTime;e.renderCallback&&e.renderCallback(),e.clock(f)}},l=function(){return date=new Date,date.getTime()},c=function(e){window.requestAnimationFrame?window.requestAnimationFrame(e):window.webkitRequestAnimationFrame?window.webkitRequestAnimationFrame(e):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(e):window.setTimeout(e,1e3/60)};a()}}),define("game/debug",["app/core","game/loop"],function(e,t){return function(e){var n=[],r,i,s=e.width;this.addFps=function(e){n=n.splice(s*-1,s),n.push(e)};var o=function(){r=new t({renderCallback:u}),i=e.getContext("2d"),r.start()},u=function(){i.clearRect(0,0,e.width,e.height),i.fillStyle="#000000",i.fillRect(0,0,e.width,e.height),i.fillStyle="#00ff00";var t=1;n.map(function(e){i.fillRect(t,100-e,1,e),t++}),i.fillStyle="#ff0000",i.fillRect(0,40,e.width,1),i.fillStyle="#cccccc",i.fillRect(0,0,e.width,1),i.fillRect(0,25,e.width,1),i.fillRect(0,50,e.width,1),i.fillRect(0,75,e.width,1),i.fillRect(0,99,e.width,1)};o()}}),define("game/vector2",["app/core"],function(e){return function(e,t){this.x=e||0,this.y=t||0,this.reset=function(e,t){return this.x=e,this.y=t,this},this.copyTo=function(e){e.x=this.x,e.y=this.y},this.copyFrom=function(e){this.x=e.x,this.y=e.y},this.add=function(e){this.x+=e.x,this.y+=e.y},this.addX=function(e){this.x+=e},this.addY=function(e){this.y+=e},this.sub=function(e){this.x-=e.x,this.y-=e.y},this.subX=function(e){this.x-=e},this.subY=function(e){this.y-=e},this.mul=function(e){this.x*=e.x,this.y*=e.y},this.mulScalar=function(e){this.x*=e,this.y*=e}}}),define("game/item/ball",["app/core","game/vector2"],function(e,t){return function(e,n,r,i){this.size=new t(r,i),this.position=new t(e,n),this.velocity=new t(5,0),this.speed=1,this.friction=.001;var s=function(){};this.update=function(e){var n=new t(this.velocity.x,this.velocity.y);n.mulScalar(this.speed*e),this.position.add(n),this.velocity.mulScalar(1-this.friction)},this.addForce=function(e){this.velocity.add(e)},s()}}),define("game/item/player",["app/core","game/vector2"],function(e,t){return function(e,n,r,i){this.size=new t(r,i),this.position=new t(e,n),this.velocity=new t(1,0),this.speed=1;var s=function(){};this.update=function(e){},s()}}),define("game/world",["app/core","game/vector2","game/item/ball","game/item/player"],function(e,t,n,r){return function(){this.size=new t(300,200),this.gravity=new t(0,-9.81),this.ball=new n(this.size.x/2,this.size.y/2,10,10),this.player=[new r(5,this.size.y/2,3,30),new r(this.size.x-5,this.size.y/2,3,30)];var e=function(){};this.update=function(e){var n=new t(this.gravity.x,this.gravity.y);n.mulScalar(e),this.ball.update(e),this.ball.addForce(n),this.ball.position.y<this.ball.size.y/2&&(this.ball.position.y=this.ball.size.y/2,this.ball.velocity.mulScalar(-1))},e()}}),define("game/render2D",["app/core"],function(e){return function(e){var t,n,r,i,s=0,o=0,u=function(){t=e.getContext("2d"),a()};this.initCanvas=function(){i=!1},this.init=function(){u()},this.draw=function(e){n=e.world,r=e.camera,i||f(),a(),c(),h(n.ball);for(var t=0;t<n.player.length;t++)h(n.player[t])};var a=function(){t.clearRect(0,0,e.width,e.height),t.fillStyle="#000000",t.fillRect(0,0,e.width,e.height)},f=function(){if(r){var t=e.width/r.size.x,n=e.height/r.size.y;i=t<n?t:n,s=e.width/2-r.size.x*i/2,o=e.height/2-r.size.y*i/2}},l=function(e){return e*i},c=function(){var e=l(r.size.x,"x"),n=l(r.size.y,"y");t.fillStyle="#ffffff",t.fillRect(s,o,e,n)},h=function(n){if(!p(n))return;posX=l(n.position.x)+s,posY=l(n.position.y)+o,width=l(n.size.x),height=l(n.size.y),t.translate(posX,e.height-posY),t.fillStyle="#ff0000",t.fillRect(-width/2,-height/2,width,height),t.translate(posX*-1,(e.height-posY)*-1)},p=function(e){return e.position.x-e.size.x/2>r.size.x||e.position.x+e.size.x/2<0||e.position.y-e.size.y/2>r.size.x||e.position.y+e.size.y/2<0?!1:!0};u()}}),define("game/camera",["app/core","game/vector2"],function(e,t){return function(e,n,r,i){this.size=new t(r,i),this.position=new t(e,n);var s=function(){};s()}}),define("game/snakepong",["app/core","game/loop","game/debug","game/world","game/render2D","game/camera"],function(e,t,n,r,i,s){return function(o){var u,a,f,l,c,h,p,d=e.dom.el("#debug"),v=e.dom.el(".fps",d),m=function(){c=new i(o),g(),u=new t({updateCallback:y,renderCallback:b,fpsCallback:w}),E(),u.start()},g=function(){a=new r,h=new s(150,100,300,200)},y=function(e){a.update(e)},b=function(){c.draw({camera:h,world:a})};this.canvasChange=function(e,t){c.initCanvas()};var w=function(e){v.innerHTML=e.toFixed(2),p.addFps(e)},E=function(){$start=e.dom.el("nav .start",d),$start.onclick=function(){u.start()},$pause=e.dom.el("nav .pause",d),$pause.onclick=function(){u.pause()},$resume=e.dom.el("nav .resume",d),$resume.onclick=function(){u.resume()},$stop=e.dom.el("nav .stop",d),$stop.onclick=function(){u.stop(),g()},p=new n(e.dom.el("#debugFps",d))};m()}}),require.config({baseUrl:"src"}),require(["app/core","gui/debug","gui/canvas-handler","game/snakepong"],function(e,t,n,r){var i=e.dom.el(".game"),s=e.dom.el("#main-canvas"),o,u,a,f=function(){l(),o=new r(s),u=new t(e.dom.el(".debug"),e.dom.el("#debug")),a=new n(s),a.registerListener(o)},l=function(){var t=e.dom.el(".toggleFullscreen",i);e.event.add(t,"click",c)},c=function(){e.classlist.toggle(i,"fullscreen")};f()}),define("main",function(){});