/**
* snakepong
* version: 0.1.0
* date: 12-11-2013
*
* Â©2013 Slemgrim
* slemgrim@gmail.com 
*
* License: GNU GENERAL PUBLIC LICENSE v2
*/
// cuon-matrix.js (c) 2012 kanda and matsuda

define("app/log",[],function(){return{error:function(e){console.log("WARNING: "+e)},warn:function(e){console.log("ERROR: "+e)},info:function(e){console.log(e)}}}),define("app/event",[],function(){return{add:function(t,n,r){if(t==null)return;t.addEventListener?t.addEventListener(n,r,!1):t.attachEvent?t.attachEvent("on"+n,r):t["on"+n]=r},remove:function(e,t){console.log("remove")},preventDefault:function(e){e.preventDefault()}}}),define("app/dom",[],function(){return{el:function(e,t){return t?t.querySelector(e):document.querySelector(e)},els:function(e,t){return t?t.querySelectorAll(e):document.querySelectorAll(e)}}}),define("app/classlist",[],function(){return{add:function(e,t){e.classList.add(t)},remove:function(e,t){e.classList.remove(t)},toggle:function(e,t){e.classList.toggle(t)},contains:function(e,t){return e.classList.contains(t)}}}),define("app/core",["app/log","app/event","app/dom","app/classlist"],function(e,t,n,r){return{log:e,event:t,dom:n,classlist:r}}),define("gui/canvas-handler",["app/core"],function(e){return function(t){if(t===null)return!1;var n,r,i=[],s=200,o=null;this.registerListener=function(e){i.push(e)},this.update=function(){f()};var u=function(){a(),f()},a=function(){e.event.add(window,"resize",f)},f=function(){o!=null&&clearTimeout(o),o=window.setTimeout(function(){l()},s)},l=function(){c(),h(),p()},c=function(){n=t.offsetWidth,r=t.offsetHeight},h=function(){t.setAttribute("width",n),t.setAttribute("height",r)},p=function(){for(var e=0;e<i.length;e++)i[e].canvasChange(n,r)};u()}}),define("game/loop",[],function(){return function(e){var t={deltaTime:.01,maxFrameTime:.25,fpsCallback:!1,renderCallback:!1,updateCallback:!1,clock:!1},n="",r=0,i=0,s=0,o=0,u={RUNNING:0,PAUSED:1,STOPPED:2},a=function(){if(typeof e=="object")for(var r in t)e[r]||(e[r]=t[r]);else e=t;e.clock||(e.clock=c),n=u.STOPPED};this.setUpdateCallback=function(t){e.updateCallback=t},this.setRenderCallback=function(t){e.rendererCallback=t},this.start=function(e){n===u.STOPPED&&(s=l(),n=u.RUNNING,e&&e(),f())},this.pause=function(e){n===u.RUNNING&&(n=u.PAUSED,e&&e())},this.stop=function(e){n!==u.STOPPED&&(n=u.STOPPED,e&&e())},this.resume=function(e){n===u.PAUSED&&(n=u.RUNNING,e&&e(),f())},this.setFPSCallback=function(t){t&&(e.fpsCallback=t)},this.setDeltaTime=function(t){e.deltaTime=t};var f=function(){if(n===u.RUNNING){var t=l(),a=t-s;i=1/a*1e3,e.fpsCallback&&e.fpsCallback(i),a>e.maxFrameTime&&(a=e.maxFrameTime),s=t,o+=a;while(o>=e.deltaTime)e.updateCallback&&e.updateCallback(e.deltaTime),r+=e.deltaTime,o-=e.deltaTime;e.renderCallback&&e.renderCallback(),e.clock(f)}},l=function(){var e=new Date;return e.getTime()},c=function(e){window.requestAnimationFrame?window.requestAnimationFrame(e):window.webkitRequestAnimationFrame?window.webkitRequestAnimationFrame(e):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(e):window.setTimeout(e,1e3/60)};a()}}),define("game/debug",["app/core","game/loop"],function(e,t){return function(e){if(e===null)return!1;var n=[],r,i,s=e.width,o=1;this.addFps=function(e){n=n.splice(s*-1,s),n.push(e)},this.reset=function(){n=[]};var u=function(){r=new t({renderCallback:a}),i=e.getContext("2d"),r.start()},a=function(){i.clearRect(0,0,e.width,e.height),i.fillStyle="#000000",i.fillRect(0,0,e.width,e.height),i.fillStyle="#00ff00",o=1,n.map(function(e){i.fillRect(o,100-e,1,e),o++}),i.fillStyle="#ff0000",i.fillRect(0,40,e.width,1),i.fillStyle="#cccccc",i.fillRect(0,0,e.width,1),i.fillRect(0,25,e.width,1),i.fillRect(0,50,e.width,1),i.fillRect(0,75,e.width,1),i.fillRect(0,99,e.width,1)};u()}}),define("game/math/vector2",[],function(){return function(e,t){typeof e=="object"?(this.x=e.x||0,this.y=e.y||0):(this.x=e||0,this.y=t||0),this.reset=function(e,t){return this.x=e,this.y=t,this},this.clear=function(e,t){this.x=0,this.y=0},this.copyTo=function(e){return e.x=this.x,e.y=this.y,this},this.copyFrom=function(e){return this.x=e.x,this.y=e.y,this},this.add=function(e){return this.x+=e.x,this.y+=e.y,this},this.sub=function(e){return this.x-=e.x,this.y-=e.y,this},this.mul=function(e){return typeof e=="object"?(this.x*=e.x,this.y*=e.y):this.x*=e,this.y*=e,this},this.div=function(e){return typeof e=="object"?(this.x/=e.x,this.y/=e.y):this.x/=e,this.y/=e,this},this.perp=function(){var e=this.x;return this.x=this.y,this.y=-e,this},this.reverse=function(){return this.x=-this.x,this.y=-this.y,this},this.nor=function(){var e=this.len();return e>0&&(this.x=this.x/e,this.y=this.y/e),this},this.scale=function(e,t){return this.x*=e,this.y*=t||e,this},this.project=function(e){var t=this.dot(e)/e.len2();return this.x=t*e.x,this.y=t*e.y,this},this.projectN=function(e){var t=this.dot(e);return this.x=t*e.x,this.y=t*e.y,this},this.reflect=function(e){var t=this.x,n=this.y;return this.project(e).scale(2),this.x-=t,this.y-=n,this},this.reflectN=function(e){var t=this.x,n=this.y;return this.projectN(e).scale(2),this.x-=t,this.y-=n,this},this.dot=function(e){return this.x*e.x+this.y*e.y},this.len2=function(){return this.dot(this)},this.len=function(){return Math.sqrt(this.len2())},this.distance=function(e){var t=this.sub(e).len();return this.add(e),t},this.equals=function(e){return this.x===e.x&&this.y===e.y},this.isZero=function(){return this.len()<1e-4},this.angleTo=function(e){return Math.atan2(e.y-this.y,e.x-this.x)},this.rotate=function(e){var t=Math.sin(e),n=Math.cos(e),r=this.x*n-this.y*t,i=this.x*t+this.y*n;return this.x=r,this.y=i,this}}}),define("game/collision/polygon",["app/core","game/math/vector2"],function(e,t){return function(e,n,r){this.TYPE="POLYGON",this.position=new t(e,n),this.points=r||[],this.edges=[],this.normals=[],this.set=function(e,t){this.position.x=e.x,this.position.y=e.y,t&&(this.points=t),this.calc()},this.calc=function(){var e=this.points,n=e.length;this.edges=[],this.normals=[];for(var r=0;r<n;r++){var i=e[r],s=r<n-1?e[r+1]:e[0],o=(new t).copyFrom(s).sub(i),u=(new t).copyFrom(o).perp().nor();this.edges.push(o),this.normals.push(u)}},this.calc()}}),define("game/collision/rectangle",["app/core","game/math/vector2","game/collision/polygon"],function(e,t,n){return function(e,r,i,s){this.TYPE="RECT",this.size=new t(i,s),this.position=new t(e,r);var o=new t,u=new t;this.update=function(e,t){this.position=e,t&&(this.size=t),this.updateCorners()},this.updateCorners=function(){o.reset(this.position.x+this.size.x/2,this.position.y+this.size.y/2),u.reset(this.position.x-this.size.x/2,this.position.y-this.size.y/2)},this.set=function(e){this.position.copyFrom(e),this.updateCorners()},this.toPolygon=function(){return new n(this.position.x,this.position.y,[new t(-this.size.x/2,-this.size.y/2),new t(this.size.x/2,-this.size.y/2),new t(-this.size.x/2,this.size.y/2),new t(this.size.x/2,this.size.y/2)])},this.getTopRight=function(){return o},this.getBottomLeft=function(){return u},this.updateCorners()}}),define("game/math/spring",["app/core","game/math/vector2"],function(e,t){return function(e,n,r,i,s){this.constant=r,this.damping=i,this.length=s,this.actor1=e,this.actor2=n,this.on=!0;var o=new t,u=new t,a=0,f=0,l=0,c=0;this.update=function(){return!this.on||!!this.actor1.statoc&&!!this.actor2.static?this:(o=o.copyFrom(this.actor1.position).sub(this.actor2.position),c=o.len(),c===0?o.clear():o.div(c),a=-1*(c-this.length)*this.constant,u=u.copyFrom(this.actor1.velocity).sub(this.actor2.velocity),f=-1*this.damping*u.dot(o),l=a+f,o.mul(l),!e.static,this.actor2.static||this.actor2.addForce(o.reverse()),this)},this.resting=function(){return!this.on||this.actor1.static&&this.actor2.static||this.actor1.static&&(this.length===0?this.actor2.position.equals(this.actor1.position):this.actor2.position.distance(this.actor1.position)<=this.length)&&this.actor2.resting()||this.actor2.static&&(this.length===0?this.actor1.position.equals(this.actor2.position):this.actor1.position.distance(this.actor2.position)<=this.length)&&this.actor1.resting()}}}),define("game/item/snake",["app/core","game/math/vector2","game/collision/rectangle","game/math/spring"],function(e,t,n,r){return function(e,i,s){this.TYPE="SNAKE",this.radius=s,this.size=new t(s*2,s*2),this.position=new t(e,i),this.velocity=new t(0,0),this.speed=3,this.friction=0,this.affectedByGravity=!0,this.collidable=!0,this.static=!1,this.bounds=new n(e,i,s*2,s*2),this.lastPlayerTouched=null,this.childs=[],this.springs=[];var o=new t,u;this.update=function(e){this.TYPE==="SNAKE"&&this.velocity.nor().mul(this.speed),this.correctDirection(),o=o.copyFrom(this.velocity),o.mul(this.speed*e);for(u=0;u<this.springs.length;u++)this.springs[u].update();this.position.add(o),this.bounds.set(this.position),this.velocity.mul(1-this.friction)},this.addForce=function(e){this.velocity.add(e)},this.correctDirection=function(){this.TYPE==="SNAKE"&&Math.abs(this.velocity.x/this.velocity.y)<1&&(this.velocity.x>=0?this.velocity.x+=.1:this.velocity.x-=.1)},this.addChild=function(e){this.childs.push(e);var t=new r(this,e,.4,.1,e.radius+this.radius);this.springs.push(t)},this.resting=function(){return this.static||this.velocity.isZero()}}}),define("game/item/player",["app/core","game/math/vector2","game/collision/rectangle"],function(e,t,n){return function(e,r,i,s){this.TYPE="PLAYER",this.size=new t(i,s),this.position=new t(e,r),this.velocity=new t(0,0),this.speed=1,this.friction=.002,this.affectedByGravity=!1,this.collidable=!0,this.static=!1,this.bounds=new n(e,r,i,s),this.ballTouches=0,this.initX=e;var o=new t;this.update=function(e){o=o.copyFrom(this.velocity),o.mul(this.speed*e),this.position.add(o),this.bounds.set(this.position),this.velocity.mul(1-this.friction),this.position.x=this.initX},this.addForce=function(e){this.velocity.add(e)},this.up=function(){this.velocity.y+=this.speed},this.down=function(){this.velocity.y-=this.speed},this.collision=function(e){if(e.TYPE==="SNAKE"){this.ballTouches++;var t=(e.position.y-this.position.y)/10;e.velocity.y+=t}e.TYPE==="WALL"&&this.velocity.reset(0,0)}}}),define("game/item/wall",["app/core","game/math/vector2","game/collision/rectangle"],function(e,t,n){return function(e,r,i,s){this.TYPE="WALL",this.size=new t(i,s),this.position=new t(e,r),this.velocity=new t(0,0),this.speed=0,this.friction=0,this.affectedByGravity=!1,this.initPosition=new t(e,r),this.collidable=!0,this.static=!0,this.bounds=new n(e,r,i,s);var o=new t;this.update=function(e){o=o.copyFrom(this.velocity),o.mul(this.speed*e),this.position.add(o),this.bounds.set(this.position),this.velocity.mul(1-this.friction),this.position.copyFrom(this.initPosition)},this.addForce=function(e){this.velocity.add(e)}}}),define("game/item/food",["app/core","game/math/vector2","game/collision/rectangle"],function(e,t,n){return function(e,r,i){this.TYPE="FOOD",this.radius=i,this.size=new t(i*2,i*2),this.position=new t(e,r),this.velocity=new t(0,0),this.speed=1,this.friction=0,this.affectedByGravity=!0,this.collidable=!1,this.static=!1,this.bounds=new n(e,r,i*2,i*2),this.points=5;var s=new t;this.update=function(e){s=s.copyFrom(this.velocity),s.mul(this.speed*e),this.position.add(s),this.bounds.set(this.position),this.velocity.mul(1-this.friction)},this.addForce=function(e){this.velocity.add(e)}}}),define("game/collision/sat",["app/core","game/math/vector2"],function(e,t){return function(){var e=[],n=[],r=-1,i=0,s=1,o,u=0,a=0,f=0,l=0,c=0,h,p,d,v,m,g,y,b,w,E=function(){for(o=0;o<10;o++)e.push(new t);for(o=0;o<5;o++)n.push([])},S=function(e,t,n){u=Number.MAX_VALUE,a=-Number.MAX_VALUE,f=e.length;for(o=0;o<f;o++)c=e[o].dot(t),c<u&&(u=c),c>a&&(a=c);n[0]=u,n[1]=a},x=function(t,r,i,s,o,u){return h=n.pop(),p=n.pop(),d=e.pop().copyFrom(r).sub(t),v=d.dot(o),S(i,o,h),S(s,o,p),p[0]+=v,p[1]+=v,m=!1,g=!1,h[0]>p[1]||p[0]>h[1]?(e.push(d),n.push(h),n.push(p),!0):(u&&(y=0,h[0]<p[0]?(u.aInB=!1,h[1]<p[1]?(y=h[1]-p[0],u.bInA=!1):(m=h[1]-p[0],g=p[1]-h[0],y=m<g?m:-g)):(u.bInA=!1,h[1]>p[1]?(y=h[0]-p[1],u.aInB=!1):(m=h[1]-p[0],g=p[1]-h[0],y=m<g?m:-g)),b=Math.abs(y),b<u.overlap&&(u.overlap=b,u.overlapN.copyFrom(o),y<0&&u.overlapN.reverse())),e.push(d),n.push(h),n.push(p),!1)},T=function(e,t){return l=e.len2(),w=t.dot(e),w<0?r:w>l?s:i};this.testPolygonPolygon=function(e,t,n){var r=e.points,i=r.length,s=t.points,o=s.length;for(var u=0;u<i;u++)if(x(e.position,t.position,r,s,e.normals[u],n))return!1;for(u=0;u<o;u++)if(x(e.position,t.position,r,s,t.normals[u],n))return!1;return n&&(n.a=e,n.b=t,n.overlapV.copyFrom(n.overlapN).scale(n.overlap)),!0},E()}}),define("game/collision/response",["app/core","game/math/vector2"],function(e,t){return function(){this.a=null,this.b=null,this.overlapN=new t,this.overlapV=new t,this.overlap=Number.MAX_VALUE,this.aInB=!0,this.bInA=!0,this.clear=function(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this}}}),define("game/collision/rectangle-collision",[],function(){return function(){var e={},t={};this.check=function(n,r){return e={left:n.position.x-n.size.x/2,right:n.position.x+n.size.x/2,top:n.position.y-n.size.y/2,bottom:n.position.y+n.size.y/2},t={left:r.position.x-r.size.x/2,right:r.position.x+r.size.x/2,top:r.position.y-r.size.y/2,bottom:r.position.y+r.size.y/2},t.left>e.right||t.right<e.left||t.top>e.bottom||t.bottom<e.top?!1:!0}}}),define("game/collision/cell",[],function(){return function(){this.objects=[];var e;this.add=function(e){this.objects.push(e)},this.remove=function(t){e=this.objects.indexOf(t),this.objects.splice(e,1)},this.clear=function(){this.objects=[]},this.size=function(){return this.objects.length},this.get=function(e){return this.objects[e]}}}),define("game/collision/spatial-hash-grid",["game/math/vector2","game/collision/cell"],function(e,t){return function(n,r,i){this.width=n,this.height=r,this.cellsize=i,this.cellsPerRow=Math.ceil(n/this.cellsize),this.cellsPerCol=Math.ceil(r/this.cellsize),this.numCells=this.cellsPerRow*this.cellsPerCol,this.dynamic=new Array(this.numCells),this.static=new Array(this.numCells),this._CELL_IDS=new Array(4),this._FOUND_OBJECTS=[];var s=0,o=0,u=0,a=-1,f,l=new e,c=new e,h,p,d,v,m,g,y;for(s=0;s<this.numCells;s++)this.dynamic[s]=new t,this.static[s]=new t;this.clearDynamic=function(){for(s=0;s<this.numCells;s++)this.dynamic[s].clear()},this.clearStatic=function(){for(s=0;s<this.numCells;s++)this.static[s].clear()},this.reset=function(){for(s=0;s<this.numCells;s++)this.dynamic[s].clear(),this.static[s].clear()},this.registerDynamicActor=function(e){this.getCellIds(e),s=0;while(s<=3&&(a=this._CELL_IDS[s++])!==-1)this.dynamic[a].add(e)},this.registerStaticActor=function(e){this.getCellIds(e),s=0;while(s<=3&&(a=this._CELL_IDS[s++])!==-1)this.static[a].add(e)},this.unregistActor=function(e){this.getCellIds(e),s=0;while(s<=3&&(a=this._CELL_IDS[s++])!==-1)this.dynamic[a].remove(e),this.static[a].remove(e)},this.getCellIds=function(e){this._CELL_IDS=new Array(4),l=e.bounds.getBottomLeft(),c=e.bounds.getTopRight(),h=Math.floor(l.x/i),d=Math.floor(l.y/i),p=Math.floor(c.x/i),v=Math.floor(c.y/i),s=0;if(h===p&&d===v)h>=0&&h<this.cellsPerRow&&d>=0&&d<this.cellsPerCol?this._CELL_IDS[0]=h+d*this.cellsPerRow:this._CELL_IDS[0]=-1,this._CELL_IDS[1]=-1,this._CELL_IDS[2]=-1,this._CELL_IDS[3]=-1;else if(h===p){s=0,h>=0&&h<this.cellsPerRow&&(d>=0&&d<this.cellsPerCol&&(this._CELL_IDS[s++]=h+d*this.cellsPerRow),v>=0&&v<this.cellsPerCol&&(this._CELL_IDS[s++]=h+v*this.cellsPerRow));while(s<=3)this._CELL_IDS[s++]=-1}else if(d===v){s=0,d>=0&&d<this.cellsPerCol&&(h>=0&&h<this.cellsPerRow&&(this._CELL_IDS[s++]=h+d*this.cellsPerRow),p>=0&&p<this.cellsPerRow&&(this._CELL_IDS[s++]=p+d*this.cellsPerRow));while(s<=3)this._CELL_IDS[s++]=-1}else{s=0,g=d*this.cellsPerRow,y=v*this.cellsPerRow,h>=0&&h<this.cellsPerRow&&d>=0&&d<this.cellsPerCol&&(this._CELL_IDS[s++]=h+g),p>=0&&p<this.cellsPerRow&&d>=0&&d<this.cellsPerCol&&(this._CELL_IDS[s++]=p+g),p>=0&&p<this.cellsPerRow&&v>=0&&v<this.cellsPerCol&&(this._CELL_IDS[s++]=p+y),h>=0&&h<this.cellsPerRow&&v>=0&&v<this.cellsPerCol&&(this._CELL_IDS[s++]=h+y);while(s<=3)this._CELL_IDS[s++]=-1}},this.getPotentialColliders=function(e){this._FOUND_OBJECTS=[],this.getCellIds(e),s=0;while(s<=3&&(a=this._CELL_IDS[s++])!==-1){u=this.dynamic[a].size();for(o=0;o<u;o++)f=this.dynamic[a].get(o),this._FOUND_OBJECTS.indexOf(f)===-1&&this._FOUND_OBJECTS.push(f);u=this.static[a].size();for(o=0;o<u;o++)f=this.static[a].get(o),this._FOUND_OBJECTS.indexOf(f)===-1&&this._FOUND_OBJECTS.push(f)}return m=this._FOUND_OBJECTS.indexOf(e),m!==-1&&this._FOUND_OBJECTS.splice(m,1),this._FOUND_OBJECTS}}}),define("game/collision/collision-handler",["app/core","game/math/vector2","game/collision/sat","game/collision/response","game/collision/rectangle-collision","game/collision/spatial-hash-grid"],function(e,t,n,r,i,s){return function(e,t,o){var u,a,f,l,c,h,p,d=[],v=0,m=0,g,y=function(){l=new n,p=new s(e,t,o,10),c=new i,h=new r};this.initStatic=function(e){p.clearStatic(),u=e;for(v=0;v<u.length;v++)a=u[v],a.collidable===!0&&a.static===!0&&p.registerStaticActor(a)},this.check=function(e){p.clearDynamic(),u=e;for(v=0;v<u.length;v++)a=u[v],a.collidable===!0&&a.static===!1&&p.registerDynamicActor(a);for(v=0;v<u.length;v++)u[v].static===!1&&(a=u[v],d=p.getPotentialColliders(u[v]),b())};var b=function(){for(m=0;m<d.length;m++){f=d[m];if(a.semiStatic===!0)continue;c.check(a.bounds,f.bounds)&&w(a,f)}},w=function(e,t){h.clear(),g=l.testPolygonPolygon(e.bounds.toPolygon(),t.bounds.toPolygon(),h),g&&(t.collidable&&(e.position.sub(h.overlapV),e.velocity.reflect(h.overlapN.perp())),e.hasOwnProperty("collision")&&e.collision(t),t.hasOwnProperty("collision")&&t.collision(e))};y()}}),define("game/input/input-handler",["app/core","game/math/vector2"],function(e,t){return function(e){this.inputs=e||{}}}),define("game/world",["app/core","game/math/vector2","game/item/snake","game/item/player","game/item/wall","game/item/food","game/collision/collision-handler","game/input/input-handler"],function(e,t,n,r,i,s,o,u){return function(){this.size=new t(300,200),this.cellSize=50,this.gravity=new t(0,0),this.roundOver=!0,this.round=1,this.maxFood=10,this.items=[],this.stats={player1:{points:0,position:{x:5,y:10}},player2:{points:0,position:{x:295,y:10}}};var e=this,a,f,l,c,h;this.inputHandler=new u({player1Up:function(){f.up()},player1Down:function(){f.down()},player2Up:function(){l.up()},player2Down:function(){l.down()}});var p=new t,d,v,m,g=function(t){for(v=t;v>0;v--){var r=new n(m.position.x,m.position.y+1,m.radius*.95);r.TYPE="TAIL",r.friction=.07,r.collidable=!1,r.semiStatic=!0,m.addChild(r),m=r,e.items.push(r)}},y=function(){for(v=0;v<5;v++){e.maxFood--;var t=new s(Math.random()*(e.size.x-40)+20,Math.random()*(e.size.y-40)+20,3);e.items.push(t)}},b=function(t){e.maxFood>0?(e.maxFood--,t.position.x=Math.random()*(e.size.x-40)+20,t.position.y=Math.random()*(e.size.y-40)+20):x(t)};this.initWorld=function(){h=new o(this.size.x,this.size.y,this.cellSize),this.items=[],a=new n(this.size.x/2,this.size.y/2,3),m=a,g(10),f=new r(5,this.size.y/2,3,40),l=new r(this.size.x-5,this.size.y/2,3,40),this.initSnake();var e,t;for(v=1;v<=this.size.x/this.cellSize;v++)e=this.cellSize,t=new i(v*this.cellSize-this.cellSize/2,this.size.y+2.4,e,5),this.items.push(t);for(v=1;v<=this.size.x/this.cellSize;v++)e=this.cellSize,t=new i(v*this.cellSize-this.cellSize/2,-2.4,e,5),this.items.push(t);for(v=1;v<=this.size.y/this.cellSize;v++)e=this.cellSize,t=new i(-2.4,v*this.cellSize-this.cellSize/2,5,e),this.items.push(t);for(v=1;v<=this.size.y/this.cellSize;v++)e=this.cellSize,t=new i(this.size.x+2.4,v*this.cellSize-this.cellSize/2,5,e),this.items.push(t);this.items.push(a),this.items.push(f),this.items.push(l),y(),h.initStatic(this.items)},this.initSnake=function(){a.position=new t(this.size.x/2,this.size.y/2),a.velocity=new t(2,0),a.collision=function(t){t.TYPE==="FOOD"?(g(t.points),a.lastPlayerTouched===f?e.stats.player1.points+=t.points:e.stats.player2.points+=t.points,b(t)):t.TYPE==="PLAYER"&&(a.lastPlayerTouched=t)}},this.initPlayer=function(){f.speed=2,l.speed=2},this.initWorld(),this.getPlayer1=function(){return f},this.getPlayer2=function(){return l},this.update=function(e){p.copyFrom(this.gravity),p.mul(e);for(var t=0;t<this.items.length;t++)d=this.items[t],d.update(e),w(d,p);h.check(this.items),this.roundOver&&S()};var w=function(e,t){e.affectedByGravity&&e.addForce(t)},E=function(t){if(t.TYPE="SNAKE")e.round++,e.roundOver=!0},S=function(){e.roundOver=!1,e.initSnake(),e.initPlayer()},x=function(t){c=e.items.indexOf(t),e.items.splice(c,1)}}}),define("game/render/canvas-helper",[],function(){return{getWebglContext:function(e){var t=null;try{t=e.getContext("webgl")||e.getContext("experimental-webgl")}catch(n){}return t||console.log("can't get webgl context"),t},initShaders:function(e,t,n){var r=this.createProgram(e,t,n);return e.useProgram(r),e.program=r,!0},createProgram:function(e,t,n){var r=this.loadShader(e,e.VERTEX_SHADER,t),i=this.loadShader(e,e.FRAGMENT_SHADER,n),s=e.createProgram();return e.attachShader(s,r),e.attachShader(s,i),e.linkProgram(s),s},loadShader:function(e,t,n){var r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}}});var Matrix4=function(e){var t,n,r;if(e&&typeof e=="object"&&e.hasOwnProperty("elements")){n=e.elements,r=new Float32Array(16);for(t=0;t<16;++t)r[t]=n[t];this.elements=r}else this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};Matrix4.prototype.setIdentity=function(){var e=this.elements;return e[0]=1,e[4]=0,e[8]=0,e[12]=0,e[1]=0,e[5]=1,e[9]=0,e[13]=0,e[2]=0,e[6]=0,e[10]=1,e[14]=0,e[3]=0,e[7]=0,e[11]=0,e[15]=1,this},Matrix4.prototype.set=function(e){var t,n,r;n=e.elements,r=this.elements;if(n===r)return;for(t=0;t<16;++t)r[t]=n[t];return this},Matrix4.prototype.concat=function(e){var t,n,r,i,s,o,u,a;n=this.elements,r=this.elements,i=e.elements;if(n===i){i=new Float32Array(16);for(t=0;t<16;++t)i[t]=n[t]}for(t=0;t<4;t++)s=r[t],o=r[t+4],u=r[t+8],a=r[t+12],n[t]=s*i[0]+o*i[1]+u*i[2]+a*i[3],n[t+4]=s*i[4]+o*i[5]+u*i[6]+a*i[7],n[t+8]=s*i[8]+o*i[9]+u*i[10]+a*i[11],n[t+12]=s*i[12]+o*i[13]+u*i[14]+a*i[15];return this},Matrix4.prototype.multiply=Matrix4.prototype.concat,Matrix4.prototype.multiplyVector3=function(e){var t=this.elements,n=e.elements,r=new Vector3,i=r.elements;return i[0]=n[0]*t[0]+n[1]*t[4]+n[2]*t[8]+t[11],i[1]=n[0]*t[1]+n[1]*t[5]+n[2]*t[9]+t[12],i[2]=n[0]*t[2]+n[1]*t[6]+n[2]*t[10]+t[13],r},Matrix4.prototype.multiplyVector4=function(e){var t=this.elements,n=e.elements,r=new Vector4,i=r.elements;return i[0]=n[0]*t[0]+n[1]*t[4]+n[2]*t[8]+n[3]*t[12],i[1]=n[0]*t[1]+n[1]*t[5]+n[2]*t[9]+n[3]*t[13],i[2]=n[0]*t[2]+n[1]*t[6]+n[2]*t[10]+n[3]*t[14],i[3]=n[0]*t[3]+n[1]*t[7]+n[2]*t[11]+n[3]*t[15],r},Matrix4.prototype.transpose=function(){var e,t;return e=this.elements,t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},Matrix4.prototype.setInverseOf=function(e){var t,n,r,i,s;n=e.elements,r=this.elements,i=new Float32Array(16),i[0]=n[5]*n[10]*n[15]-n[5]*n[11]*n[14]-n[9]*n[6]*n[15]+n[9]*n[7]*n[14]+n[13]*n[6]*n[11]-n[13]*n[7]*n[10],i[4]=-n[4]*n[10]*n[15]+n[4]*n[11]*n[14]+n[8]*n[6]*n[15]-n[8]*n[7]*n[14]-n[12]*n[6]*n[11]+n[12]*n[7]*n[10],i[8]=n[4]*n[9]*n[15]-n[4]*n[11]*n[13]-n[8]*n[5]*n[15]+n[8]*n[7]*n[13]+n[12]*n[5]*n[11]-n[12]*n[7]*n[9],i[12]=-n[4]*n[9]*n[14]+n[4]*n[10]*n[13]+n[8]*n[5]*n[14]-n[8]*n[6]*n[13]-n[12]*n[5]*n[10]+n[12]*n[6]*n[9],i[1]=-n[1]*n[10]*n[15]+n[1]*n[11]*n[14]+n[9]*n[2]*n[15]-n[9]*n[3]*n[14]-n[13]*n[2]*n[11]+n[13]*n[3]*n[10],i[5]=n[0]*n[10]*n[15]-n[0]*n[11]*n[14]-n[8]*n[2]*n[15]+n[8]*n[3]*n[14]+n[12]*n[2]*n[11]-n[12]*n[3]*n[10],i[9]=-n[0]*n[9]*n[15]+n[0]*n[11]*n[13]+n[8]*n[1]*n[15]-n[8]*n[3]*n[13]-n[12]*n[1]*n[11]+n[12]*n[3]*n[9],i[13]=n[0]*n[9]*n[14]-n[0]*n[10]*n[13]-n[8]*n[1]*n[14]+n[8]*n[2]*n[13]+n[12]*n[1]*n[10]-n[12]*n[2]*n[9],i[2]=n[1]*n[6]*n[15]-n[1]*n[7]*n[14]-n[5]*n[2]*n[15]+n[5]*n[3]*n[14]+n[13]*n[2]*n[7]-n[13]*n[3]*n[6],i[6]=-n[0]*n[6]*n[15]+n[0]*n[7]*n[14]+n[4]*n[2]*n[15]-n[4]*n[3]*n[14]-n[12]*n[2]*n[7]+n[12]*n[3]*n[6],i[10]=n[0]*n[5]*n[15]-n[0]*n[7]*n[13]-n[4]*n[1]*n[15]+n[4]*n[3]*n[13]+n[12]*n[1]*n[7]-n[12]*n[3]*n[5],i[14]=-n[0]*n[5]*n[14]+n[0]*n[6]*n[13]+n[4]*n[1]*n[14]-n[4]*n[2]*n[13]-n[12]*n[1]*n[6]+n[12]*n[2]*n[5],i[3]=-n[1]*n[6]*n[11]+n[1]*n[7]*n[10]+n[5]*n[2]*n[11]-n[5]*n[3]*n[10]-n[9]*n[2]*n[7]+n[9]*n[3]*n[6],i[7]=n[0]*n[6]*n[11]-n[0]*n[7]*n[10]-n[4]*n[2]*n[11]+n[4]*n[3]*n[10]+n[8]*n[2]*n[7]-n[8]*n[3]*n[6],i[11]=-n[0]*n[5]*n[11]+n[0]*n[7]*n[9]+n[4]*n[1]*n[11]-n[4]*n[3]*n[9]-n[8]*n[1]*n[7]+n[8]*n[3]*n[5],i[15]=n[0]*n[5]*n[10]-n[0]*n[6]*n[9]-n[4]*n[1]*n[10]+n[4]*n[2]*n[9]+n[8]*n[1]*n[6]-n[8]*n[2]*n[5],s=n[0]*i[0]+n[1]*i[4]+n[2]*i[8]+n[3]*i[12];if(s===0)return this;s=1/s;for(t=0;t<16;t++)r[t]=i[t]*s;return this},Matrix4.prototype.invert=function(){return this.setInverseOf(this)},Matrix4.prototype.setOrtho=function(e,t,n,r,i,s){var o,u,a,f;if(e===t||n===r||i===s)throw"null frustum";return u=1/(t-e),a=1/(r-n),f=1/(s-i),o=this.elements,o[0]=2*u,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2*a,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=-2*f,o[11]=0,o[12]=-(t+e)*u,o[13]=-(r+n)*a,o[14]=-(s+i)*f,o[15]=1,this},Matrix4.prototype.ortho=function(e,t,n,r,i,s){return this.concat((new Matrix4).setOrtho(e,t,n,r,i,s))},Matrix4.prototype.setFrustum=function(e,t,n,r,i,s){var o,u,a,f;if(e===t||r===n||i===s)throw"null frustum";if(i<=0)throw"near <= 0";if(s<=0)throw"far <= 0";return u=1/(t-e),a=1/(r-n),f=1/(s-i),o=this.elements,o[0]=2*i*u,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2*i*a,o[6]=0,o[7]=0,o[8]=(t+e)*u,o[9]=(r+n)*a,o[10]=-(s+i)*f,o[11]=-1,o[12]=0,o[13]=0,o[14]=-2*i*s*f,o[15]=0,this},Matrix4.prototype.frustum=function(e,t,n,r,i,s){return this.concat((new Matrix4).setFrustum(e,t,n,r,i,s))},Matrix4.prototype.setPerspective=function(e,t,n,r){var i,s,o,u;if(n===r||t===0)throw"null frustum";if(n<=0)throw"near <= 0";if(r<=0)throw"far <= 0";e=Math.PI*e/180/2,o=Math.sin(e);if(o===0)throw"null frustum";return s=1/(r-n),u=Math.cos(e)/o,i=this.elements,i[0]=u/t,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=u,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=-(r+n)*s,i[11]=-1,i[12]=0,i[13]=0,i[14]=-2*n*r*s,i[15]=0,this},Matrix4.prototype.perspective=function(e,t,n,r){return this.concat((new Matrix4).setPerspective(e,t,n,r))},Matrix4.prototype.setScale=function(e,t,n){var r=this.elements;return r[0]=e,r[4]=0,r[8]=0,r[12]=0,r[1]=0,r[5]=t,r[9]=0,r[13]=0,r[2]=0,r[6]=0,r[10]=n,r[14]=0,r[3]=0,r[7]=0,r[11]=0,r[15]=1,this},Matrix4.prototype.scale=function(e,t,n){var r=this.elements;return r[0]*=e,r[4]*=t,r[8]*=n,r[1]*=e,r[5]*=t,r[9]*=n,r[2]*=e,r[6]*=t,r[10]*=n,r[3]*=e,r[7]*=t,r[11]*=n,this},Matrix4.prototype.setTranslate=function(e,t,n){var r=this.elements;return r[0]=1,r[4]=0,r[8]=0,r[12]=e,r[1]=0,r[5]=1,r[9]=0,r[13]=t,r[2]=0,r[6]=0,r[10]=1,r[14]=n,r[3]=0,r[7]=0,r[11]=0,r[15]=1,this},Matrix4.prototype.translate=function(e,t,n){var r=this.elements;return r[12]+=r[0]*e+r[4]*t+r[8]*n,r[13]+=r[1]*e+r[5]*t+r[9]*n,r[14]+=r[2]*e+r[6]*t+r[10]*n,r[15]+=r[3]*e+r[7]*t+r[11]*n,this},Matrix4.prototype.setRotate=function(e,t,n,r){var i,s,o,u,a,f,l,c,h,p,d,v;return e=Math.PI*e/180,i=this.elements,s=Math.sin(e),o=Math.cos(e),0!==t&&0===n&&0===r?(t<0&&(s=-s),i[0]=1,i[4]=0,i[8]=0,i[12]=0,i[1]=0,i[5]=o,i[9]=-s,i[13]=0,i[2]=0,i[6]=s,i[10]=o,i[14]=0,i[3]=0,i[7]=0,i[11]=0,i[15]=1):0===t&&0!==n&&0===r?(n<0&&(s=-s),i[0]=o,i[4]=0,i[8]=s,i[12]=0,i[1]=0,i[5]=1,i[9]=0,i[13]=0,i[2]=-s,i[6]=0,i[10]=o,i[14]=0,i[3]=0,i[7]=0,i[11]=0,i[15]=1):0===t&&0===n&&0!==r?(r<0&&(s=-s),i[0]=o,i[4]=-s,i[8]=0,i[12]=0,i[1]=s,i[5]=o,i[9]=0,i[13]=0,i[2]=0,i[6]=0,i[10]=1,i[14]=0,i[3]=0,i[7]=0,i[11]=0,i[15]=1):(u=Math.sqrt(t*t+n*n+r*r),u!==1&&(a=1/u,t*=a,n*=a,r*=a),f=1-o,l=t*n,c=n*r,h=r*t,p=t*s,d=n*s,v=r*s,i[0]=t*t*f+o,i[1]=l*f+v,i[2]=h*f-d,i[3]=0,i[4]=l*f-v,i[5]=n*n*f+o,i[6]=c*f+p,i[7]=0,i[8]=h*f+d,i[9]=c*f-p,i[10]=r*r*f+o,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1),this},Matrix4.prototype.rotate=function(e,t,n,r){return this.concat((new Matrix4).setRotate(e,t,n,r))},Matrix4.prototype.setLookAt=function(e,t,n,r,i,s,o,u,a){var f,l,c,h,p,d,v,m,g,y,b,w;return l=r-e,c=i-t,h=s-n,p=1/Math.sqrt(l*l+c*c+h*h),l*=p,c*=p,h*=p,d=c*a-h*u,v=h*o-l*a,m=l*u-c*o,g=1/Math.sqrt(d*d+v*v+m*m),d*=g,v*=g,m*=g,y=v*h-m*c,b=m*l-d*h,w=d*c-v*l,f=this.elements,f[0]=d,f[1]=y,f[2]=-l,f[3]=0,f[4]=v,f[5]=b,f[6]=-c,f[7]=0,f[8]=m,f[9]=w,f[10]=-h,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,this.translate(-e,-t,-n)},Matrix4.prototype.lookAt=function(e,t,n,r,i,s,o,u,a){return this.concat((new Matrix4).setLookAt(e,t,n,r,i,s,o,u,a))},Matrix4.prototype.dropShadow=function(e,t){var n=new Matrix4,r=n.elements,i=e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3];return r[0]=i-t[0]*e[0],r[1]=-t[1]*e[0],r[2]=-t[2]*e[0],r[3]=-t[3]*e[0],r[4]=-t[0]*e[1],r[5]=i-t[1]*e[1],r[6]=-t[2]*e[1],r[7]=-t[3]*e[1],r[8]=-t[0]*e[2],r[9]=-t[1]*e[2],r[10]=i-t[2]*e[2],r[11]=-t[3]*e[2],r[12]=-t[0]*e[3],r[13]=-t[1]*e[3],r[14]=-t[2]*e[3],r[15]=i-t[3]*e[3],this.concat(n)},Matrix4.prototype.dropShadowDirectionally=function(e,t,n,r,i,s,o,u,a){var f=r*e+i*t+s*n;return this.dropShadow([e,t,n,-f],[o,u,a,0])};var Vector3=function(e){var t=new Float32Array(3);e&&typeof e=="object"&&(t[0]=e[0],t[1]=e[1],t[2]=e[2]),this.elements=t};Vector3.prototype.normalize=function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=Math.sqrt(t*t+n*n+r*r);return i?i==1?this:(i=1/i,e[0]=t*i,e[1]=n*i,e[2]=r*i,this):(e[0]=0,e[1]=0,e[2]=0,this)};var Vector4=function(e){var t=new Float32Array(4);e&&typeof e=="object"&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),this.elements=t};define("lib/cuon-matrix.js",function(){}),define("game/render/render3D",["app/core","game/render/canvas-helper","game/math/vector2","lib/cuon-matrix.js"],function(e,t,n){return function(e){if(e===null)return!1;var n,r,i,s,o,u,a=0,f=0,l,c,h,p,d,v=new Matrix4,m=new Matrix4,g=new Matrix4,y=new Matrix4,b=new Matrix4,w=new Float32Array,E=new Float32Array,S=new Float32Array,x=new Uint8Array,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U=document.querySelector("#shader-vs").innerHTML,z=document.querySelector("#shader-fs").innerHTML,W=function(){r=t.getWebglContext(e),t.initShaders(r,U,z),L=r.getUniformLocation(r.program,"u_MvpMatrix"),A=r.getUniformLocation(r.program,"u_ModelMatrix"),O=r.getUniformLocation(r.program,"u_NormalMatrix"),H=r.getUniformLocation(r.program,"u_AmbientLight"),j=r.getUniformLocation(r.program,"u_LightColor1"),B=r.getUniformLocation(r.program,"u_LightPosition1"),I=r.getUniformLocation(r.program,"u_LightColor2"),F=r.getUniformLocation(r.program,"u_LightPosition2"),R=r.getUniformLocation(r.program,"u_LightColor3"),q=r.getUniformLocation(r.program,"u_LightPosition3"),r.uniform3f(j,0,0,0,0),r.uniform3f(B,150,100,100),r.uniform3f(I,1,0,0,0),r.uniform3f(F,0,100,1),r.uniform3f(R,0,0,1,0),r.uniform3f(q,300,100,1),r.uniform3f(H,.1,.1,.1),n=100/Math.tan(15*(Math.PI/180)),g.setPerspective(30,1.5,1,1e3),m.setLookAt(150,100,n,150,100,0,0,1,0),Z(),b.setInverseOf(y),b.transpose(),r.uniformMatrix4fv(L,!1,v.elements),r.uniformMatrix4fv(O,!1,b.elements),C=r.createBuffer(),i=K(),r.enable(r.DEPTH_TEST),r.clearColor(0,0,0,0),X()};this.initCanvas=function(){Y(),r.viewport(a,f,c.size.x*s,c.size.y*s)},this.toggleBoundingBoxes=function(){},this.init=function(){W()},this.draw=function(e){l=e.world,c=e.camera,h=l.getPlayer1(),p=l.getPlayer2(),m.setLookAt(150,100,n,150,100,0,0,1,0),Z(),r.uniformMatrix4fv(L,!1,v.elements),X();for(d=0;d<l.items.length;d++)$(l.items[d])};var X=function(){r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT)},V=function(){G(l.size.x/2,l.size.y/2,0,l.size.x,l.size.y,{r:1,g:1,b:1})},$=function(e){e.TYPE==="SNAKE"||e.TYPE==="TAIL"||e.TYPE==="FOOD"?(N!=="ball"&&(i=K()),y.setTranslate(e.position.x,e.position.y,1),y.scale(e.size.x/2,e.size.y/2,5),y.rotate(90,1,0,0)):(N!=="cube"&&(i=J()),y.setTranslate(e.position.x,e.position.y,1),y.scale(e.size.x/2,e.size.y/2,5)),G()},J=function(){return N="cube",w=new Float32Array([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1]),E=new Float32Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]),S=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1]),x=new Uint8Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),k=r.createBuffer(),Q(S,3,"a_Normal"),Q(w,3,"a_Position"),Q(E,3,"a_Color"),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,k),r.bufferData(r.ELEMENT_ARRAY_BUFFER,x,r.STATIC_DRAW),x.length},K=function(){N="ball";var e=20,t,n,i,s,o,u,a,f,l,c,h=[],p=[],d=[],v=[];for(o=0;o<=e;o++){u=o*Math.PI/e,a=Math.sin(u),f=Math.cos(u);for(t=0;t<=e;t++)n=t*2*Math.PI/e,i=Math.sin(n),s=Math.cos(n),h.push(i*a),h.push(f),h.push(s*a),d.push(i*a),d.push(f),d.push(s*a),p.push(1),p.push(1),p.push(1)}for(o=0;o<e;o++)for(t=0;t<e;t++)l=o*(e+1)+t,c=l+(e+1),v.push(l),v.push(c),v.push(l+1),v.push(l+1),v.push(c),v.push(c+1);return k=r.createBuffer(),Q(new Float32Array(h),3,"a_Position"),Q(new Float32Array(d),3,"a_Normal"),Q(new Float32Array(p),3,"a_Color"),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,k),r.bufferData(r.ELEMENT_ARRAY_BUFFER,new Uint16Array(v),r.STATIC_DRAW),v.length},Q=function(e,t,n){return T=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,T),r.bufferData(r.ARRAY_BUFFER,e,r.STATIC_DRAW),M=r.getAttribLocation(r.program,n),r.vertexAttribPointer(M,t,r.FLOAT,!1,0,0),r.enableVertexAttribArray(M),!0},G=function(){Z(),r.uniformMatrix4fv(O,!1,b.elements),r.uniformMatrix4fv(A,!1,y.elements),r.uniformMatrix4fv(L,!1,v.elements),r.uniform3f(F,10,h.position.y,1),r.uniform3f(q,290,p.position.y,1),r.drawElements(r.TRIANGLES,i,r.UNSIGNED_BYTE,0)},Y=function(){c&&(o=e.width/c.size.x,u=e.height/c.size.y,s=o<u?o:u,a=e.width/2-c.size.x*s/2,f=e.height/2-c.size.y*s/2)},Z=function(){v.set(g).multiply(m).multiply(y)};W()}}),define("game/camera",["app/core","game/math/vector2"],function(e,t){return function(e,n,r,i){this.size=new t(r,i),this.position=new t(e,n);var s=function(){};s()}}),define("game/input/keyboard-controller",["app/core"],function(e){return function(t,n){var r={};document.onkeydown=function(e){var i=(e||window.event).keyCode;return i in t?(i in r||(r[i]=null,t[i](),n!==0&&(r[i]=setInterval(t[i],n))),!1):!0},document.onkeyup=function(e){var t=(e||window.event).keyCode;t in r&&(r[t]!==null&&clearInterval(r[t]),delete r[t])},window.onblur=function(){for(var e in r)r[e]!==null&&clearInterval(r[e]);r={}}}}),define("game/snakepong",["app/core","game/loop","game/debug","game/world","game/render/render3D","game/camera","game/input/keyboard-controller"],function(e,t,n,r,i,s,o){return function(u){if(u===null)return;var a,f,l,c,h,p,d,v=e.dom.el("#debug"),m=e.dom.el(".fps",v),g=60,y=.3,b=function(){h=new i(u),w(),a=new t({updateCallback:E,renderCallback:S,fpsCallback:x}),T(),a.start()},w=function(){f=new r,p=new s(150,100,300,200);var e=new o({87:function(){f.inputHandler.inputs.player1Up()},83:function(){f.inputHandler.inputs.player1Down()},38:function(){f.inputHandler.inputs.player2Up()},40:function(){f.inputHandler.inputs.player2Down()}},100)},E=function(e){f.update(e)},S=function(){h.draw({camera:p,world:f})};this.canvasChange=function(e,t){h.initCanvas()};var x=function(e){m.innerHTML=e.toFixed(2),d.addFps(e)},T=function(){var t=e.dom.el("nav .start",v);t&&(t.onclick=function(){a.start()});var r=e.dom.el("nav .pause",v);r&&(r.onclick=function(){a.pause()});var i=e.dom.el("nav .resume",v);i&&(i.onclick=function(){a.resume()});var s=e.dom.el("nav .stop",v);s&&(s.onclick=function(){a.stop(),w(),d.reset()});var o=e.dom.el("nav .boundingToggle",v);o&&(o.onclick=function(){h.toggleBoundingBoxes()}),d=new n(e.dom.el("#debugFps",v))};b()}}),require.config({baseUrl:"src"}),require(["app/core","gui/canvas-handler","game/snakepong"],function(e,t,n){var r=e.dom.el(".game"),i=e.dom.el("#main-canvas"),s,o=e.dom.el("#debug"),u,a=function(){if(i===null)return!1;f(),s=new n(i),u=new t(i),u.registerListener(s)},f=function(){var t=e.dom.el(".toggleFullscreen",r);e.event.add(t,"click",l),e.event.add(document,"keydown",function(t){var n=(t||window.evt).keyCode;n===68?e.classlist.toggle(o,"show"):n===70&&(e.classlist.toggle(r,"fullscreen"),u.update())})},l=function(){u.update(),e.classlist.toggle(r,"fullscreen")};a()}),define("main",function(){});